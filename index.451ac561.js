const t=Object.freeze({Start:"start",Restart:"restart",Hidden:"hidden",ActionButton:"button"}),e=Object.freeze({Start:"Start",Restart:"Restart"});var s={};class r{static START_TILES_QUANTITY_DEFAULT=2;static DEFAULT_BOARD=[,,,,].fill().map(()=>[,,,,].fill(0));static MOVE_KEYS=Object.freeze(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"]);static STATUS=Object.freeze({Idle:"Idle",Playing:"Playing",Lost:"Lost",Won:"Won"});status=r.STATUS.Idle;score=0;constructor(t=structuredClone(r.DEFAULT_BOARD),e=r.START_TILES_QUANTITY_DEFAULT){this.state=t,this.startTilesAmount=e}get size(){return this.state.length}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}move(t){switch(t){case"ArrowUp":this.moveUp();break;case"ArrowRight":this.moveRight();break;case"ArrowDown":this.moveDown();break;case"ArrowLeft":this.moveLeft()}this.placeNewTile(),this.updateGameStatus()}handleMove(){for(let t=0;t<this.size;t++){let e=[];for(let s=0;s<this.size;s++)0!==this.state[s][t]&&e.push(this.state[s][t]);let s=[],r=0;for(;r<e.length;)if(r+1<e.length&&e[r]===e[r+1]){let t=2*e[r];s.push(t),this.score+=t,r+=2}else s.push(e[r]),r++;for(;s.length<this.size;)s.push(0);for(let e=0;e<this.size;e++)this.state[e][t]=s[e]}}moveUp(){this.handleMove()}moveDown(){this.reverseGrid(),this.handleMove(),this.reverseGrid()}moveLeft(){this.rotateClockwise(),this.handleMove(),this.rotateCounterClockwise()}moveRight(){this.rotateCounterClockwise(),this.handleMove(),this.rotateClockwise()}reverseGrid(){this.state.reverse()}transpose(){for(let t=0;t<this.size;t++)for(let e=t+1;e<this.size;e++)[this.state[t][e],this.state[e][t]]=[this.state[e][t],this.state[t][e]]}rotateClockwise(){this.transpose(),this.state.forEach(t=>t.reverse())}rotateCounterClockwise(){this.state.forEach(t=>t.reverse()),this.transpose()}updateGameStatus(){if(!this.checkMovePossibility()){for(let t of(this.status=r.STATUS.Lost,this.state))if(t.includes(2048)){this.status=r.STATUS.Won;return}}}start(){this.status=r.STATUS.Playing;for(let t=0;t<this.startTilesAmount;t++)this.placeNewTile()}restart(){this.status=r.STATUS.Idle,this.state=structuredClone(r.DEFAULT_BOARD),this.score=0,this.start()}getTwoOrFour(){return .9>Math.random()?2:4}placeNewTile(){let t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)0===this.state[e][s]&&t.push({row:e,col:s});if(t.length>0){let e=Math.floor(Math.random()*t.length),{row:s,col:r}=t[e];this.state[s][r]=this.getTwoOrFour()}}checkMovePossibility(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)if(0===this.state[t][e])return!0;for(let t=0;t<this.size;t++)for(let e=0;e<this.size-1;e++)if(this.state[t][e]===this.state[t][e+1])return!0;for(let t=0;t<this.size;t++)for(let e=0;e<this.size-1;e++)if(this.state[e][t]===this.state[e+1][t])return!0;return!1}}const i=new(s=r),o=document.querySelector(".container"),a=o.querySelector(".controls button"),l=o.querySelector(".controls .info"),h=o.querySelector(".controls .game-score"),n=o.querySelector(".game-field tbody"),c=o.querySelector(".message-start"),u=o.querySelector(".message-win"),d=o.querySelector(".message-lose");function S(){h.textContent=i.getScore(),function(){let t=i.getState(),e=n.rows.length,s=n.rows[0].cells.length;for(let r=0;r<e;r++)for(let e=0;e<s;e++){let s=n.rows[r].cells[e],i=t[r][e];s.textContent=i||"",s.className=`field-cell ${i?`field-cell--${i}`:""}`}}(),function(){let r=i.getStatus(),o=r===s.STATUS.Idle;switch(c.classList.add(t.Hidden),u.classList.add(t.Hidden),d.classList.add(t.Hidden),a.classList.remove(t.Restart,t.Start),a.classList.add(o?t.Start:t.Restart),a.textContent=o?e.Start:e.Restart,r){case s.STATUS.Won:u.classList.remove(t.Hidden);break;case s.STATUS.Lost:d.classList.remove(t.Hidden)}}()}document.addEventListener("keydown",t=>{s.MOVE_KEYS.includes(t.key)&&(t.preventDefault(),i.move(t.key),S())}),a.addEventListener("click",()=>{i.getStatus()===s.STATUS.Idle?i.start():i.restart(),S()}),l.addEventListener("click",()=>{console.log(i.getScore())});
//# sourceMappingURL=index.451ac561.js.map
